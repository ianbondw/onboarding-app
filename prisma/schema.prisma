generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

enum OnboardingStatus {
  DRAFT
  SUBMITTED
}

enum RiskTolerance {
  Low
  Medium
  High
}

model OnboardingSession {
  id          String           @id @default(cuid())
  token       String           @unique
  status      OnboardingStatus @default(DRAFT)
  submittedAt DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  client      Client?
}

model Client {
  id       String @id @default(cuid())
  email    String @unique
  fullName String

  // üîê Encrypted SSN at rest (AES-256-GCM), plus last4 for UX
  ssnLast4      String
  ssnCiphertext String
  ssnIv         String
  ssnTag        String

  dob DateTime

  netWorth         Decimal
  income           Decimal
  investableAssets Decimal

  riskTolerance       RiskTolerance
  termsAccepted       Boolean
  kycCitizenship      String?
  kycEmploymentStatus String?
  kycSourceOfFunds    String?

  onboardingSessionId String?            @unique
  onboardingSession   OnboardingSession? @relation(fields: [onboardingSessionId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
